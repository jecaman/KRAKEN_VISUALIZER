<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Portfolio Visualizer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://kit.fontawesome.com/yourkitcode.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="main-horizontal">
  <!-- Branding: Logo + Slogan -->
  <div class="branding-column">
    <img src="{{ url_for('static', filename='logo_kraken.png') }}" alt="Tentacle Logo" class="main-logo" />
  </div>

  <!-- T√≠tulo + Formulario -->
  <div class="form-block">
    <h1 class="main-title">Portfolio Visualizer</h1>
    <p class="subtitle">Track your true crypto performance.</p>

    <form id="apiForm">
      <div class="input-icon">
        <label for="apiKey">API Key:</label>
        <i class="fas fa-key"></i>
        <input type="text" id="apiKey" required />
      </div>

      <div class="input-icon">
        <label for="apiSecret">API Secret:</label>
        <i class="fas fa-lock"></i>
        <input type="password" id="apiSecret" required />
      </div>

      <button type="submit">
        <span>Fetch Portfolio</span>
      </button>
    </form>

    <p class="kraken-disclaimer">‚ö†Ô∏è Only works with <strong>Kraken Pro API Keys</strong></p>

    <div id="loadingIcon" class="btc-loader" style="display: none;">
      <img src="{{ url_for('static', filename='bitcoin.svg') }}" alt="Loading..." />
      <p class="btc-text">Fetching portfolio, please wait...</p>
    </div>
  </div>
</div>
</div>

    <!-- KPI y Gr√°ficos -->
    <section id="globalSummarySection" style="display: none;">
      <h2>üìä Global Portfolio Summary</h2>

      <div id="kpiContainer" style="display: flex;">
        <div class="kpiBox"><h3>Total Invested</h3><p id="kpiInvested">-</p></div>
        <div class="kpiBox"><h3>Current Value</h3><p id="kpiValue">-</p></div>
        <div class="kpiBox"><h3>Liquidity</h3><p id="kpiLiquidity">-</p></div>
        <div class="kpiBox"><h3>Profit</h3><p id="kpiProfit">-</p></div>
        <div class="kpiBox"><h3>Profit %</h3><p id="kpiProfitPct">-</p></div>
      </div>

      <div id="chartContainer" style="display: none;">
        <div id="donutSection">
          <h3>Portfolio Distribution</h3>
          <canvas id="donutChart"></canvas>
        </div>
        <div id="investmentSection">
          <h3>Investment Distribution</h3>
          <canvas id="investmentPieChart"></canvas>
        </div>
        <div id="summarySection">
          <h3>Portfolio Summary</h3>
          <canvas id="summaryChart"></canvas>
        </div>
        <div id="timelineSection" style="display: none;">
          <h3>üìà Evoluci√≥n del Valor Total</h3>
          <label for="granularityFilter"><strong>Granularidad:</strong></label>
          <select id="granularityFilter">
            <option value="daily">Diario</option>
            <option value="weekly">Semanal</option>
            <option value="monthly">Mensual</option>
          </select>
          <canvas id="portfolioTimelineChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Tabla -->
    <section id="tableSection" style="display: none; margin-top: 40px;">
      <h2>üìÑ Portfolio Breakdown (per asset)</h2>
      <table id="portfolioTable" style="display: none;">
        <thead>
          <tr>
            <th>Asset</th>
            <th>Amount</th>
            <th>Avg. Cost (‚Ç¨)</th>
            <th>Current Price (‚Ç¨)</th>
            <th>Invested (‚Ç¨)</th>
            <th>Value (‚Ç¨)</th>
            <th>PNL (‚Ç¨)</th>
            <th>PNL (%)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Filtro de activos -->
    <section id="assetAnalysisSection" style="display: none; margin-top: 40px;">
      <h2>üîç Asset-Specific Analysis</h2>
      <div id="filterSection" style="margin-bottom: 20px;">
        <label for="assetFilter">Select Asset:</label>
        <select id="assetFilter">
          <option value="ALL">ALL</option>
        </select>
      </div>
      <div id="assetChartsContainer"></div>
    </section>

    <!-- Errores y mensajes -->
    <p id="errorMsg"></p>
    <p id="loadingMsg"></p>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-profile">
      <img src="https://avatars.githubusercontent.com/jecaman" alt="Avatar" class="footer-avatar" />
      <div>
        Made with ‚ù§Ô∏è by jecaman<br>
        <a href="mailto:jesuscamposmanjon@gmail.com">üìß Email</a> ¬∑
        <a href="https://github.com/jecaman" target="_blank">üíª GitHub</a>
      </div>
    </div>
  </footer>

  <!-- Script -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    document.getElementById("apiForm").addEventListener("submit", function () {
      document.getElementById("loadingIcon").style.display = "block";
    });

    document.getElementById("toggleExplanationBtn").addEventListener("click", function () {
      const extra = document.getElementById("extraExplanation");
      const isVisible = extra.style.display === "block";
      extra.style.display = isVisible ? "none" : "block";
      this.textContent = isVisible ? "See more" : "See less";
    });
  </script>
</body>

</html>
